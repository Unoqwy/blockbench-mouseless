!function i(n,r,s){function a(t,e){if(!r[t]){if(!n[t]){var o="function"==typeof require&&require;if(!e&&o)return o(t,!0);if(l)return l(t,!0);throw(o=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",o}o=r[t]={exports:{}},n[t][0].call(o.exports,function(e){return a(n[t][1][e]||e)},o,o.exports,i,n,r,s)}return r[t].exports}for(var l="function"==typeof require&&require,e=0;e<s.length;e++)a(s[e]);return a}({1:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.injectStylesheet=void 0,o.injectStylesheet=function(e,t){const o=document.createElement("style");return o.id=e,o.innerHTML=t,$(o).appendTo("head"),o}},{}],2:[function(e,t,o){"use strict";var i,n=this&&this.__classPrivateFieldGet||function(e,t,o,i){if("a"===o&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?i:"a"===o?i.call(e):i?i.value:t.get(e)};Object.defineProperty(o,"__esModule",{value:!0}),o.SwathePlugin=void 0;const r=e("./inject"),s=e("./storage"),a=e("./unstable");o.SwathePlugin=class{constructor(e,t,o){if(i.set(this,[]),/[^a-z0-9_]/.test(e))throw new Error("Invalid plugin id! It must be alphanumeric and lowercase.");this.id=e,t.about=(t.about?t.about+"<br/>":"")+"This plugin is part of the <a href='https://github.com/Unoqwy/swathe'>Swathe</a> plugin collection.",this.options=t,null!=o&&o.storage&&(this.storage=s.Storage.load("swathe_"+e))}register(e=!0,t){for(const o of["oninstall","onuninstall","onload","onunload"])void 0!==this.options[o]&&(this.options[o]=this.options[o].bind(this));e&&(this.registerEvent("onload",{before:()=>this.hook(t),after:this.postInit.bind(this)}),this.registerEvent("onunload",{after:this.unhook.bind(this)})),BBPlugin.register(this.id,this.options)}registerEvent(e,t){const o=this.options[e];this.options[e]=function(){null!=t&&t.before&&t.before(),void 0!==o&&o(),null!=t&&t.after&&t.after()}}hook(e){null!=e&&e.stylesheet&&r.injectStylesheet(`swathe-css-${this.id.replaceAll("_","-")}`,e.stylesheet)}postInit(){Object.values(Toolbars).forEach(e=>{e.postload&&e.update()})}unhook(){var e;null!==(e=this.styleElement)&&void 0!==e&&e.remove(),n(this,i,"f").forEach(a.unloadAction)}createAction(e,t){t=new Action(e,t);return n(this,i,"f").push(t),t}},i=new WeakMap},{"./inject":1,"./storage":3,"./unstable":4}],3:[function(e,t,o){"use strict";var i,n=this&&this.__classPrivateFieldSet||function(e,t,o,i,n){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?n.call(e,o):n?n.value=o:t.set(e,o),o},r=this&&this.__classPrivateFieldGet||function(e,t,o,i){if("a"===o&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?i:"a"===o?i.call(e):i?i.value:t.get(e)};Object.defineProperty(o,"__esModule",{value:!0}),o.Storage=void 0;o.Storage=class o{constructor(e,t){i.set(this,void 0),this.name=e,n(this,i,null!=t?t:{},"f")}get(e){return r(this,i,"f")[e]}set(e,t){void 0===t?this.remove(e):r(this,i,"f")[e]!==t&&(r(this,i,"f")[e]=t,this.persist())}remove(e){delete r(this,i,"f")[e]&&this.persist()}persist(){localStorage.setItem(this.name,JSON.stringify(r(this,i,"f")))}static load(e){var t=localStorage.getItem(e);return new o(e,void 0!==t?JSON.parse(t):{})}},i=new WeakMap},{}],4:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.unloadAction=void 0;const r=e("./utils");o.unloadAction=function(t){delete BarItems[t.id];for(const n of t.toolbars){let e=0;for(;e<n.children.length;){var o=n.children[e];o===t||o.id===t?(n.children.splice(e,1),!r.removeFromArray(o.toolbars,n)||void 0!==(o=parseInt(Object.entries(n.positionLookup).find(([,e])=>e===t)[0]))&&(void 0===n.postload&&(n.postload=[]),n.postload.push([t.id,o]))):e++}n.update()}var e,i;r.removeFromArray(Keybinds.actions,t)&&(e=t.category,i=Keybinds.structure[e].actions,r.removeFromArray(i,t),0==i.length&&delete Keybinds.structure[e]),Object.keys(t).forEach(e=>delete t[e]),t.id="DISABLED"}},{"./utils":5}],5:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.removeFromArray=void 0,o.removeFromArray=function(e,t){return-1!==(t=t,-1!=(t=(e=e).indexOf(t))&&e.splice(t,1),t)}},{}],6:[function(e,t,o){"use strict";var a,l=this&&this.__classPrivateFieldGet||function(e,t,o,i){if("a"===o&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?i:"a"===o?i.call(e):i?i.value:t.get(e)};Object.defineProperty(o,"__esModule",{value:!0});const i=e("../../core/plugin"),c=e("./keyboard");var n,d,r=e("./std/std.js"),o=e("./std/defaults.js");(n=n||{}).vimode=!1;let s,u;const h=new i.SwathePlugin("mouseless",{icon:"keyboard",title:"Mouseless",author:"Unoqwy",description:"Vi-like keybindings in Blockbench",variant:"desktop",onload:()=>{n.vimode=h.storage.get("vi-mode"),Blockbench.on("press_key",f),h.createAction("toggle_vi_mode",{name:"Toggle vi mode",icon:"star",category:"mouseless",click:()=>{var e=n.vimode=!n.vimode;h.storage.set("vi-mode",e||void 0),p()}}),$(document).on("keydown.mouseless",e=>{u!==e.originalEvent?_.clearInputStack():_.handleKeyEvent(e.originalEvent),u=void 0});const e=document.createElement("div");e.id="mouseless-line";var t=document.createElement("span");e.appendChild(t);const o=document.createElement("span");o.id="mlv-input",e.appendChild(o),$("#status_bar").prepend(e),s={root:e,state:t,input:o},p()},onunload:()=>{Blockbench.removeListener("press_key",f),$(document).off(".mouseless"),$(s.root).remove()}},{storage:!0});function p(){void 0!==s&&(s.state.innerHTML="Vi-mode: "+(n.vimode?"on":"off"))}function f(e){const{event:t,input_in_focus:o,capture:i}=e;return!(!(t instanceof KeyboardEvent&&n.vimode)||o)&&(t.ctrlKey&&t.shiftKey&&"I"===t.key?currentwindow.toggleDevTools():void 0!==open_menu&&(u=t),i())}h.register(!0,{stylesheet:"#mouseless-line{position:absolute;bottom:26px}#mouseless-line #mlv-input{padding-left:3px}"}),(e=d=d||{})[e.None=0]="None",e[e.Operator=1]="Operator",e[e.OperatorOptions=2]="OperatorOptions",e[e.MotionCount=3]="MotionCount",e[e.Motion=4]="Motion",e[e.Keybinding=5]="Keybinding";class v{constructor(){this.op={},this.reset()}reset(){this.at=d.None,this.stack=void 0,this.trail=void 0,delete this.op.operator,delete this.op.motionCount}appendToTrail(e){void 0===this.trail?this.trail=e:this.trail+=e,void 0===this.stack?this.stack=e:this.stack+=e}}class m{}const y=["Tab","Space"];a=new WeakMap;const g=new Proxy({},{get:(e,t)=>function(){BarItems[t].click()}});function b(e,t){var o,i;0!==selected.length&&(o=e,i={elements:selected},e=function(){return!1!==t(selected)&&void updateSelection()},Undo.initEdit(i),!1!==e()?Undo.finishEdit(o):Undo.cancelEdit())}const w=["x","y","z"];function k(e){return w.indexOf(e)}const _=new class{constructor(){this.operators={},this.keybindings={},a.set(this,new v)}handleKeyEvent(t){var o,{key:i}=t;if("Shift"!==i&&"Control"!==i&&"Alt"!==i&&"Meta"!==i){if("Escape"===i||c.onlyModifiers(t,{ctrl:!0})&&"["==i)return this.clearInputStack();const r=l(this,a,"f");if(r.at===d.MotionCount&&/^[+-.0-9]$/.test(i)){if(void 0!==r.trail&&("+"===i||"-"===i)||"."===i&&void 0!==r.trail&&-1!==r.trail.indexOf("."))return this.clearInputStack();"."!==i||void 0!==r.trail&&"-"!==r.trail?this.appendToTrail(i):this.appendToTrail("0.")}else{if("<"===i||">"===i||!/^[\x22-\x7F]$/.test(i)&&!y.includes(i))return this.clearInputStack();{r.at===d.MotionCount&&(o=parseFloat(r.trail),isNaN(o)||(r.op.motionCount=o),r.trail=void 0,r.at=d.Motion);let e=y.includes(i)?`<${i}>`:i;if(t.ctrlKey&&(e="<C-"+e+">"),this.appendToTrail(e),r.at===d.None||r.at===d.Operator){var n=this.checkAndReserveInputKind(this.operators,d.Operator);n instanceof m&&(r.op.operator=n,r.at=d.MotionCount)}else if(r.at===d.Motion)return"s"===i||"n"===i?void 0:("x"===i||"y"===i||"z"===i?r.op.operator.exec(null!==(n=r.op.motionCount)&&void 0!==n?n:1,r.trail):"a"===i&&["x","y","z"].forEach(e=>{var t;r.op.operator.exec(null!==(t=r.op.motionCount)&&void 0!==t?t:1,r.trail.slice(0,-1)+e)}),this.clearInputStack());if(r.at===d.None||r.at===d.Keybinding){const s=this.checkAndReserveInputKind(this.keybindings,d.Keybinding);if(!0!==s)return!1!==s&&s(),this.clearInputStack()}}}}}checkAndReserveInputKind(e,t){const o=l(this,a,"f");var i=e[o.trail];if(void 0!==i)return o.trail=void 0,i;e=0!=Object.keys(e).filter(e=>e.startsWith(o.trail)).length;return e&&o.at!==t&&(o.at=t),e}appendToTrail(e){l(this,a,"f").appendToTrail(e),s.input.innerHTML="Â· "+l(this,a,"f").stack}clearInputStack(){l(this,a,"f").reset(),s.input.innerHTML=""}source(e,t){const r=this;var o={map:function o(i,n){Object.entries(i).forEach(([e,t])=>{void 0!==n&&(e=n+e),"function"==typeof t?r.keybindings[e]=t:"string"==typeof t&&o(i,void 0!==n?n+e:e)})},action:g};t.bind(o)()}};function E(e,o){_.operators[e]=new class extends m{exec(e,t){o(e,t)}}}E("m",(e,t)=>{b("Move",()=>function(e,t){moveElementsInSpace(e,t)}(e,k(t)))}),E("r",(t,e)=>{b("Rotate",()=>rotateOnAxis(e=>e+t,k(e)))}),E("s",(t,e)=>{const o=2===e.length?e[0]:void 0,i=e.slice(-1);b("Resize",e=>{e.forEach(e=>{e.resizable&&(void 0!==o&&"n"!==o||e.resize(e=>e+t,k(i),!1,!1),void 0!==o&&"s"!==o||e.resize(e=>e+-t,k(i),!0,!1))})})}),_.source("std",r),_.source("defaults",o)},{"../../core/plugin":2,"./keyboard":7,"./std/defaults.js":8,"./std/std.js":9}],7:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.onlyModifiers=void 0,o.onlyModifiers=function(e,t){var o,i;return e.ctrlKey===(null!==(o=t.ctrl)&&void 0!==o&&o)&&e.shiftKey===(null!==(i=t.shift)&&void 0!==i&&i)&&e.altKey===(null!==(i=t.alt)&&void 0!==i&&i)&&e.metaKey===(null!==(t=t.meta)&&void 0!==t&&t)}},{}],8:[function(e,t,o){t.exports=function(){const{map:e,action:t}=this;e({"<C-n>":t.add_cube,"<C-g>":t.add_group,"<C-d>":t.duplicate,"<Tab>":t.toggle_quad_view})}},{}],9:[function(e,t,o){t.exports=function(){const{map:e,action:t}=this;e({u:Undo.undo,"<C-r>":Undo.redo,dd:t.delete})}},{}]},{},[6]);