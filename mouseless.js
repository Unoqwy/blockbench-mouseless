!function(){function d(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t).value}class o{get(t){return d(this,i)[t]}set(t,e){void 0===e?this.remove(t):d(this,i)[t]!==e&&(d(this,i)[t]=e,this.persist())}remove(t){delete d(this,i)[t]&&this.persist()}persist(){localStorage.setItem(this.name,JSON.stringify(d(this,i)))}static load(t){var e=localStorage.getItem(t);return new o(t,void 0!==e?JSON.parse(e):{})}constructor(t,e){i.set(this,{writable:!0,value:void 0}),this.name=t,function(t,e,i){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");if(!(t=e.get(t)).writable)throw new TypeError("attempted to set read only private field");t.value=i}(this,i,null!=e?e:{})}}var i=new WeakMap;function s(t,e){return-1!==(e=e,-1!=(e=(t=t).indexOf(e))&&t.splice(e,1),e)}function e(e){delete BarItems[e.id];for(const n of e.toolbars){let t=0;for(;t<n.children.length;){var i=n.children[t];i===e||i.id===e?(n.children.splice(t,1),!s(i.toolbars,n)||void 0!==(i=parseInt(Object.entries(n.positionLookup).find(([,t])=>t===e)[0]))&&(void 0===n.postload&&(n.postload=[]),n.postload.push([e.id,i]))):t++}n.update()}var t,o;s(Keybinds.actions,e)&&(t=e.category,s(o=Keybinds.structure[t].actions,e),0==o.length&&delete Keybinds.structure[t]),Object.keys(e).forEach(t=>delete e[t]),e.id="DISABLED"}var n,c,t,r=new WeakMap;(n=n||{}).vimode=!1;let a,l;const u=new class{register(t=!0,e){for(const i of["oninstall","onuninstall","onload","onunload"])void 0!==this.options[i]&&(this.options[i]=this.options[i].bind(this));t&&(this.registerEvent("onload",{before:()=>this.hook(e),after:this.postInit.bind(this)}),this.registerEvent("onunload",{after:this.unhook.bind(this)})),BBPlugin.register(this.id,this.options)}registerEvent(t,e){const i=this.options[t];this.options[t]=function(){null!=e&&e.before&&e.before(),void 0!==i&&i(),null!=e&&e.after&&e.after()}}hook(t){null!=t&&t.stylesheet&&function(t,e){const i=document.createElement("style");i.id=t,i.innerHTML=e,$(i).appendTo("head"),i}(`swathe-css-${this.id.replaceAll("_","-")}`,t.stylesheet)}postInit(){Object.values(Toolbars).forEach(t=>{t.postload&&t.update()})}unhook(){var t;null!==(t=this.styleElement)&&void 0!==t&&t.remove(),d(this,r).forEach(e)}createAction(t,e){d(this,r).push(new Action(t,e))}constructor(t,e,i){if(r.set(this,{writable:!0,value:[]}),/[^a-z0-9_]/.test(t))throw new Error("Invalid plugin id! It must be alphanumeric and lowercase.");this.id=t,e.about=(e.about?e.about+"<br/>":"")+"This plugin is part of the <a href='https://github.com/Unoqwy/swathe'>Swathe</a> plugin collection.",this.options=e,null!=i&&i.storage&&(this.storage=o.load("swathe_"+t))}}("mouseless",{icon:"keyboard",title:"Mouseless",author:"Unoqwy",description:"Vi-like keybindings in Blockbench",variant:"desktop",onload:()=>{n.vimode=u.storage.get("vi-mode"),Keybinds.capture.push(p),u.createAction("toggle_vi_mode",{name:"Toggle vi mode",icon:"star",category:"mouseless",click:()=>{var t=n.vimode=!n.vimode;u.storage.set("vi-mode",t||void 0),h()}}),$(document).on("keydown.mouseless",t=>{l!==t.originalEvent?w.clearInputStack():w.handleKeyEvent(t.originalEvent),l=void 0});const t=document.createElement("div");t.id="mouseless-line";var e=document.createElement("span");t.appendChild(e);const i=document.createElement("span");i.id="mlv-input",t.appendChild(i),$("#status_bar").prepend(t),a={root:t,state:e,input:i},h()},onunload:()=>{s(Keybinds.capture,p),$(document).off(".mouseless"),$(a.root).remove()}},{storage:!0});function h(){void 0!==a&&(a.state.innerHTML="Vi-mode: "+(n.vimode?"on":"off"))}function p(t){if(!(t.originalEvent instanceof KeyboardEvent&&n.vimode))return!1;t=t.originalEvent;return t.ctrlKey&&t.shiftKey&&"I"===t.key?currentwindow.toggleDevTools():void 0!==open_menu&&(l=t),!0}u.register(!0,{stylesheet:"#mouseless-line{position:absolute;bottom:26px}#mouseless-line #mlv-input{padding-left:3px}"}),(t=c=c||{})[t.None=0]="None",t[t.Operator=1]="Operator",t[t.OperatorOptions=2]="OperatorOptions",t[t.MotionCount=3]="MotionCount",t[t.Motion=4]="Motion",t[t.Keybinding=5]="Keybinding";class v{reset(){this.at=c.None,this.stack=void 0,this.trail=void 0,delete this.op.operator,delete this.op.motionCount}appendToTrail(t){void 0===this.trail?this.trail=t:this.trail+=t,void 0===this.stack?this.stack=t:this.stack+=t}constructor(){this.op={},this.reset()}}class f{}const g=["Tab","Space"];var m=new WeakMap;function b(t,e){var i,o;0!==selected.length&&(i=t,o={elements:selected},t=function(){return!1!==e(selected)&&void updateSelection()},Undo.initEdit(o),!1!==t()?Undo.finishEdit(i):Undo.cancelEdit())}const y=["x","y","z"];function k(t){return y.indexOf(t)}const w=new class{handleKeyEvent(e){var t,i,o,n,{key:s}=e;if("Shift"!==s&&"Control"!==s&&"Alt"!==s&&"Meta"!==s){if("Escape"===s||(n={ctrl:!0},(t=e).ctrlKey===(null!==(i=n.ctrl)&&void 0!==i&&i)&&t.shiftKey===(null!==(o=n.shift)&&void 0!==o&&o)&&t.altKey===(null!==(o=n.alt)&&void 0!==o&&o)&&t.metaKey===(null!==(n=n.meta)&&void 0!==n&&n)&&"["==s))return this.clearInputStack();const a=d(this,m);if(a.at===c.MotionCount&&/^[+-.0-9]$/.test(s)){if(void 0!==a.trail&&("+"===s||"-"===s)||"."===s&&void 0!==a.trail&&-1!==a.trail.indexOf("."))return this.clearInputStack();"."!==s||void 0!==a.trail&&"-"!==a.trail?this.appendToTrail(s):this.appendToTrail("0.")}else{if("<"===s||">"===s||!/^[\x22-\x7F]$/.test(s)&&!g.includes(s))return this.clearInputStack();{a.at===c.MotionCount&&(n=parseFloat(a.trail),isNaN(n)||(a.op.motionCount=n),a.trail=void 0,a.at=c.Motion);let t=g.includes(s)?`<${s}>`:s;if(e.ctrlKey&&(t="<C-"+t+">"),this.appendToTrail(t),a.at===c.None||a.at===c.Operator){var r=this.checkAndReserveInputKind(this.operators,c.Operator);r instanceof f&&(a.op.operator=r,a.at=c.MotionCount)}else if(a.at===c.Motion)return"s"===s||"n"===s?void 0:("x"===s||"y"===s||"z"===s?a.op.operator.exec(null!==(r=a.op.motionCount)&&void 0!==r?r:1,a.trail):"a"===s&&["x","y","z"].forEach(t=>{var e;a.op.operator.exec(null!==(e=a.op.motionCount)&&void 0!==e?e:1,a.trail.slice(0,-1)+t)}),this.clearInputStack());if(a.at===c.None||a.at===c.Keybinding){const l=this.checkAndReserveInputKind(this.keybindings,c.Keybinding);if(!0!==l)return!1!==l&&l(),this.clearInputStack()}}}}}checkAndReserveInputKind(t,e){const i=d(this,m);var o=t[i.trail];if(void 0!==o)return i.trail=void 0,o;t=0!=Object.keys(t).filter(t=>t.startsWith(i.trail)).length;return t&&i.at!==e&&(i.at=e),t}appendToTrail(t){d(this,m).appendToTrail(t),a.input.innerHTML="Â· "+d(this,m).stack}clearInputStack(){d(this,m).reset(),a.input.innerHTML=""}constructor(){m.set(this,{writable:!0,value:new v}),this.operators={},this.keybindings={}}};function E(t,i){w.operators[t]=new class extends f{exec(t,e){i(t,e)}}}E("m",(t,e)=>{b("Move",()=>function(t,e){moveElementsInSpace(t,e)}(t,k(e)))}),E("r",(e,t)=>{b("Rotate",()=>rotateOnAxis(t=>t+e,k(t)))}),E("s",(e,t)=>{const i=2===t.length?t[0]:void 0,o=t.slice(-1);console.log(i,o),b("Resize",t=>{t.forEach(t=>{t.resizable&&(void 0!==i&&"n"!==i||t.resize(t=>t+e,k(o),!1,!1),void 0!==i&&"s"!==i||t.resize(t=>t+-e,k(o),!0,!1))})})}),w.keybindings.u=()=>Undo.undo(),w.keybindings["<C-r>"]=()=>Undo.redo(),w.keybindings.dd=()=>BarItems.delete.click(),w.keybindings["<C-n>"]=()=>BarItems.add_cube.click(),w.keybindings["<C-d>"]=()=>BarItems.duplicate.click(),w.keybindings["<Tab>"]=()=>BarItems.toggle_quad_view.click(),w.keybindings["<C-h>"]=()=>BarItems.toggle_left_sidebar.click(),w.keybindings["<C-l>"]=()=>BarItems.toggle_right_sidebar.click(),w.keybindings.RL=()=>BarItems.reload_plugins.click()}();